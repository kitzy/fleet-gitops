- name: macOS - Enable FileVault
  platform: darwin
  description: This policy checks if FileVault (disk encryption) is enabled.
  resolution: As an IT admin, turn on disk encryption in Fleet.
  query: SELECT 1 FROM filevault_status WHERE status = 'FileVault is On.';

- name: macOS - Disable guest account
  platform: darwin
  description: This policy checks if the guest account is disabled.
  resolution: An an IT admin, deploy a macOS, login window profile with the DisableGuestAccount option set to true.
  query: SELECT 1 FROM managed_policies WHERE domain='com.apple.loginwindow' AND username = '' AND name='DisableGuestAccount' AND CAST(value AS INT) = 1;

- name: macOS - Enable Firewall
  platform: darwin
  description: This policy checks if Firewall is enabled.
  resolution: An an IT admin, deploy a macOS, Firewall profile with the EnableFirewall option set to true.
  query: SELECT 1 FROM managed_policies WHERE domain='com.apple.security.firewall' AND username = '' AND name='EnableFirewall' AND CAST(value AS INT) = 1;

- name: macOS - System Integrity Protection (SIP)
  platform: darwin
  description: This policy checks if System Integrity Protection (SIP) is enabled.
  resolution: |
    Reboot the Mac into Recovery (hold âŒ˜ + R during startup).
    Open Terminal from the Utilities menu.
    Run `csrutil enable`
    Reboot normally.
  query: SELECT 1 FROM sip_config WHERE config_flag = 'sip' AND enabled = 1;

- name: macOS - Require 8 character password
  platform: darwin
  description: This policy checks if the end user is required to enter a password, with at least 8 characters, to unlock the host.
  resolution: An an IT admin, deploy a macOS, screensaver profile with the askForPassword option set to true and minLength option set to 10.
  query: |
    SELECT 1 WHERE 
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.screensaver' AND 
            name='askForPassword' AND 
            CAST(value AS INT)
        )
      AND EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.screensaver' AND 
            name='minLength' AND 
            CAST(value AS INT) <= 8
        );

- name: macOS - Software Update - Disallow pre-release installation
  platform: darwin
  description: This policy checks that pre-release macOS updates are not offered to users.
  resolution: As an IT admin, deploy or update a macOS Software Update profile (domain com.apple.SoftwareUpdate) with AllowPreReleaseInstallation set to false at the system scope.
  query: SELECT 1 FROM managed_policies WHERE domain='com.apple.SoftwareUpdate' AND username='' AND name='AllowPreReleaseInstallation' AND CAST(value AS INT)=0;

- name: macOS - Software Update - Automatic check enabled
  platform: darwin
  description: This policy checks that the system automatically checks for software updates.
  resolution: As an IT admin, deploy or update a macOS Software Update profile (domain com.apple.SoftwareUpdate) with AutomaticCheckEnabled set to true at the system scope.
  query: SELECT 1 FROM managed_policies WHERE domain='com.apple.SoftwareUpdate' AND username='' AND name='AutomaticCheckEnabled' AND CAST(value AS INT)=1;

- name: macOS - Software Update - Automatic download enabled
  platform: darwin
  description: This policy checks that available updates are downloaded automatically.
  resolution: As an IT admin, deploy or update a macOS Software Update profile (domain com.apple.SoftwareUpdate) with AutomaticDownload set to true at the system scope.
  query: SELECT 1 FROM managed_policies WHERE domain='com.apple.SoftwareUpdate' AND username='' AND name='AutomaticDownload' AND CAST(value AS INT)=1;

- name: macOS - Software Update - Auto-install App Store updates
  platform: darwin
  description: This policy checks that App Store updates are auto-installed.
  resolution: As an IT admin, deploy or update a macOS Software Update profile (domain com.apple.SoftwareUpdate) with AutomaticallyInstallAppUpdates set to true at the system scope.
  query: SELECT 1 FROM managed_policies WHERE domain='com.apple.SoftwareUpdate' AND username='' AND name='AutomaticallyInstallAppUpdates' AND CAST(value AS INT)=1;

- name: macOS - Software Update - Do not auto-install macOS updates
  platform: darwin
  description: This policy checks that macOS updates are not auto-installed (installation remains admin-driven).
  resolution: As an IT admin, deploy or update a macOS Software Update profile (domain com.apple.SoftwareUpdate) with AutomaticallyInstallMacOSUpdates set to false at the system scope.
  query: SELECT 1 FROM managed_policies WHERE domain='com.apple.SoftwareUpdate' AND username='' AND name='AutomaticallyInstallMacOSUpdates' AND CAST(value AS INT)=0;

- name: macOS - Software Update - Install configuration data
  platform: darwin
  description: This policy checks that system data files and security configuration updates are enabled.
  resolution: As an IT admin, deploy or update a macOS Software Update profile (domain com.apple.SoftwareUpdate) with ConfigDataInstall set to true at the system scope.
  query: SELECT 1 FROM managed_policies WHERE domain='com.apple.SoftwareUpdate' AND username='' AND name='ConfigDataInstall' AND CAST(value AS INT)=1;

- name: macOS - Software Update - Install critical updates
  platform: darwin
  description: This policy checks that critical updates are installed automatically.
  resolution: As an IT admin, deploy or update a macOS Software Update profile (domain com.apple.SoftwareUpdate) with CriticalUpdateInstall set to true at the system scope.
  query: SELECT 1 FROM managed_policies WHERE domain='com.apple.SoftwareUpdate' AND username='' AND name='CriticalUpdateInstall' AND CAST(value AS INT)=1;
